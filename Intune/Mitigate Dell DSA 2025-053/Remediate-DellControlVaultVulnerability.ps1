# How to get the MSI Installer:
# - Download the new version from https://www.dell.com/support/home/en-us/drivers/driversdetails?driverid=TWF65
# - Run the file and extract it
# - Go to the new extracted folder and get the CVHCI64.exe file
# - Run that file and get it to the install screen but don't actually run the install
# - Go to your %temp% user directory and search for the CVHCI64.msi file
# Credits to r/ListNaive3219 on Reddit: https://www.reddit.com/r/sysadmin/comments/1mjw406/comment/n7gk3hd/?utm_source=share&utm_medium=web3x&utm_name=web3xcss&utm_term=1&utm_content=share_button

$downloadLink = "https://www.example.com/location/of/installer/file/CVHCI64.msi"
$fileName = "controlvault.msi"
$RebootTime = "7PM"
$forceReboot = $true
try {
	Invoke-WebRequest $downloadLink -OutFile "$env:TEMP\$fileName"
}
catch {
	Write-Log -Level Error -Message "Failed to download $fileName."
	exit 1
}
if (Test-Path "$env:TEMP\$fileName") {
	Start-Process msiexec -ArgumentList "/i `"$env:TEMP\$fileName`"","/qn" -Wait;
    Start-Sleep -Seconds 120
    Remove-Item -Path "$env:TEMP\$fileName"
    if ($forceReboot) {
        shutdown -r -t $([int]([datetime]"$RebootTime" - (Get-Date)).TotalSeconds)
    }
}
else {
	Write-Log -Level Error -Message "Failed to download $fileName."
	exit 1
}
exit 0
